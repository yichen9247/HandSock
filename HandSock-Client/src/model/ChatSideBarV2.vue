<!--
 * @Description: 聊天侧边栏组件
 * @Author: Hua
 * @Date: 2024-11-25
 * @LastEditors: Hua
 * @LastEditTime: 2024-11-25
-->

<script setup lang="ts">
    import { Reactive } from "vue"
    import utils from "@/scripts/utils"
    import socket from "@/socket/socket"
    import { sidebarListType } from "../../types"
    import { Router, useRouter } from 'vue-router'
    import { toggleChatChannel } from '@/socket/socketClient'
    import { openUserLogoutDialog } from "@/socket/socketClient"
    import { setSearchDialog, setSettingDialog, openAboutThisProject, openGithubSite, setPersonalDialog, toggleAdminFrame } from "@/scripts/action"

    const router: Router = useRouter();
    const insertStatus: Ref<boolean> = ref(false);
    const applicationStore = utils.useApplicationStore();

    const sidebarList: Reactive<Array<sidebarListType>> = reactive([{
        name: '首页',
        call: (): Promise<void> => toggleChatChannel(router, 0),
        icon: '<svg t="1736469030918" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20272" width="36" height="36"><path d="M668.59 914.92h-73.06V653.14H428.48v261.78h-73.06V634.07c0-29.77 24.22-53.99 53.99-53.99h205.18c29.77 0 53.99 24.22 53.99 53.99v280.85z" fill="#474747" p-id="20273"></path><path d="M811.49 944.62H212.51c-38.76 0-70.29-31.73-70.29-70.73V398.77h73.06v472.79h593.43V398.77h73.06v475.12c0 39-31.53 70.73-70.28 70.73z" fill="#474747" p-id="20274"></path><path d="M966.47 444.04L537.68 89.82c-7.03-6.91-16.33-10.47-25.68-10.44-9.35-0.02-18.64 3.53-25.68 10.44L57.53 444.04c-15.55 12.85-17.75 35.88-4.9 51.43 12.85 15.55 35.88 17.75 51.43 4.9L512 163.38l407.94 336.99c15.55 12.85 38.58 10.66 51.43-4.9 12.85-15.55 10.66-38.58-4.9-51.43z" fill="#474747" p-id="20275"></path></svg>'
    }, {
        name: '频道',
        call: (): Promise<void> => setSearchDialog(true),
        icon: '<svg t="1736469290470" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="42240" width="36" height="36"><path d="M796 811.2H230.4c-99.2 0-180-80.8-180-180v-360c0-99.2 80.8-180 180-180h565.6c99.2 0 180 80.8 180 180v360c0 99.2-80.8 180-180 180zM230.4 181.6c-49.6 0-90.4 40.8-90.4 90.4v360c0 49.6 40.8 90.4 90.4 90.4h565.6c49.6 0 90.4-40.8 90.4-90.4V272c0-49.6-40.8-90.4-90.4-90.4H230.4z m0 0" fill="#474A54" p-id="42241"></path><path d="M462.4 653.6c-27.2 0-52-6.4-72-20-47.2-31.2-69.6-94.4-63.2-188.8 4.8-96.8 31.2-155.2 83.2-182.4 52-27.2 116.8-13.6 200 38.4 84 51.2 121.6 105.6 120 164-2.4 58.4-47.2 105.6-135.2 151.2-49.6 26.4-94.4 37.6-132.8 37.6z m6.4-314.4c-8.8 0-13.6 2.4-16 2.4-20 8.8-31.2 49.6-36 105.6-4.8 83.2 16 103.2 22.4 110.4 8.8 6.4 38.4 16 114.4-22.4C633.6 496 640 467.2 640 460c0-6.4-4.8-36-76.8-83.2-47.2-28.8-76-37.6-94.4-37.6z m0 0M755.2 944.8H260c-24.8 0-44.8-20-44.8-44.8 0-24.8 20-44.8 44.8-44.8h495.2c24.8 0 44.8 20 44.8 44.8 0 24.8-20.8 44.8-44.8 44.8z m0 0" fill="#474A54" p-id="42242"></path></svg>'
    }, {
        name: '仓库',
        call: (): Window => openGithubSite(),
        icon: '<svg t="1703493832460" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5620" width="36" height="36"><path d="M427.392 853.504a61.44 61.44 0 0 1-1.450667 15.530667 92.586667 92.586667 0 0 1-10.965333 27.605333c-15.061333 25.301333-40.661333 42.154667-73.642667 42.154667-77.653333 0-108.117333-38.101333-146.261333-133.504C169.216 740.693333 157.013333 725.461333 128 725.461333v-85.333333c77.653333 0 108.117333 38.101333 146.261333 133.504 25.856 64.597333 38.058667 79.786667 67.072 79.786667 0-12.373333-0.170667-23.296-0.512-38.144-0.853333-34.816-0.938667-41.941333 0.554667-51.2 0.64-20.352 5.888-34.773333 16.384-49.066667-95.232-20.736-159.445333-63.573333-196.309333-132.992l-13.824-32.426667C134.186667 510.848 128 467.072 128 416.426667c0-58.24 17.749333-110.336 50.944-153.856-10.368-41.386667-8.96-91.989333 13.909333-149.077334l7.466667-18.688 19.2-6.101333c2.56-0.853333 5.632-1.578667 9.301333-2.133333 37.290667-5.888 90.325333 8.106667 159.701334 52.48a565.930667 565.930667 0 0 1 127.274666-14.208c38.741333 0 77.226667 3.882667 114.048 11.605333 67.456-42.24 119.04-55.509333 155.306667-49.92 3.626667 0.597333 6.741333 1.322667 9.258667 2.133333l19.285333 6.101334 7.466667 18.773333c20.010667 50.218667 23.424 96.469333 16.128 136.96C875.434667 296.32 896 352.597333 896 416.512c0 53.888-3.84 94.378667-14.933333 133.802667l-11.733334 32.170666c-30.677333 69.333333-98.304 112.64-202.538666 133.248 10.837333 15.018667 15.872 30.250667 15.872 52.394667v42.666667l-0.042667 42.666666a13.013333 13.013333 0 0 0 0.341333 2.730667L682.666667 938.794667c-36.352 0-63.36-17.706667-76.672-45.653334a88.277333 88.277333 0 0 1-8.661334-40.277333v-84.736c0-3.584-0.128-3.797333-8.832-12.501333-23.296-23.296-33.834667-40.874667-33.834666-72.832v-38.613334l38.4-3.84c114.346667-11.52 176.512-43.221333 197.12-89.6l9.6-26.325333c7.68-27.562667 10.88-61.098667 10.88-107.946667 0-49.706667-17.365333-90.837333-50.218667-123.648L742.4 274.773333l7.381333-24.448c6.528-21.717333 8.106667-47.402667 1.152-76.714666a158.634667 158.634667 0 0 0-3.584 0.938666c-22.826667 6.4-51.370667 20.053333-85.76 43.008l-15.658666 10.453334-18.304-4.522667a467.754667 467.754667 0 0 0-111.829334-13.269333c-42.709333 0-84.906667 5.418667-123.946666 16.042666l-19.029334 5.205334-16.256-11.136c-35.541333-24.32-65.109333-38.826667-88.746666-45.568a158.293333 158.293333 0 0 0-4.864-1.28c-8.234667 33.92-4.992 61.781333 3.413333 82.688l9.984 25.088-18.346667 19.797333C228.693333 332.629333 213.333333 370.986667 213.333333 416.512c0 41.685333 4.864 76.202667 13.824 102.229333l11.178667 26.453334c27.904 52.352 87.168 83.84 192.853333 95.146666l38.144 4.096v38.357334c0 32-10.538667 49.536-33.834666 72.832-8.704 8.704-8.832 8.96-8.832 12.501333l-0.725334 7.893333c-0.512 2.56-0.512 9.258667 0.170667 37.205334 0.298667 12.8 0.469333 22.997333 0.554667 33.621333a33.962667 33.962667 0 0 1 0.725333 6.656z" p-id="5621" fill="#474A54"></path></svg>'
    }, {
        name: '关于',
        call: (): void => openAboutThisProject(),
        icon: '<svg t="1703496071634" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9471" width="36" height="36"><path d="M512 64c247.424 0 448 200.576 448 448s-200.576 448-448 448S64 759.424 64 512 264.576 64 512 64z m0 85.333333C311.701333 149.333333 149.333333 311.701333 149.333333 512s162.368 362.666667 362.666667 362.666667 362.666667-162.368 362.666667-362.666667S712.298667 149.333333 512 149.333333z m21.333333 277.333334a21.333333 21.333333 0 0 1 21.333334 21.333333v298.666667a21.333333 21.333333 0 0 1-21.333334 21.333333h-42.666666a21.333333 21.333333 0 0 1-21.333334-21.333333V448a21.333333 21.333333 0 0 1 21.333334-21.333333h42.666666z m0-170.666667a21.333333 21.333333 0 0 1 21.333334 21.333333v42.666667a21.333333 21.333333 0 0 1-21.333334 21.333333h-42.666666a21.333333 21.333333 0 0 1-21.333334-21.333333v-42.666667a21.333333 21.333333 0 0 1 21.333334-21.333333h42.666666z" fill="#474A54" p-id="9472"></path></svg>'
    }, {
        name: '设置',
        call: (): Promise<void> => setSettingDialog(true),
        icon: '<svg t="1703494205002" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8280" width="36" height="36"><path d="M469.333333 60.693333a85.333333 85.333333 0 0 1 85.333334 0l326.826666 188.714667a85.333333 85.333333 0 0 1 42.666667 73.898667v377.386666a85.333333 85.333333 0 0 1-42.666667 73.898667L554.666667 963.306667a85.333333 85.333333 0 0 1-85.333334 0L142.506667 774.592a85.333333 85.333333 0 0 1-42.666667-73.898667v-377.386666a85.333333 85.333333 0 0 1 42.666667-73.898667z m42.666667 73.898667L185.173333 323.306667v377.386666L512 889.408l326.826667-188.714667v-377.386666L512 134.592zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 85.333334a85.333333 85.333333 0 1 0 0 170.666666 85.333333 85.333333 0 0 0 0-170.666666z" fill="#474A54" p-id="8281"></path></svg>'
    }, {
        name: '退出登录',
        call: (): Promise<void> => openUserLogoutDialog(),
        icon: '<svg t="1729505518099" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17831" width="36" height="36"><path d="M663.68 247.253333L701.653333 170.666667A427.605333 427.605333 0 0 1 938.666667 553.770667C938.666667 789.888 747.648 981.333333 512 981.333333S85.333333 789.888 85.333333 553.770667C85.333333 389.717333 178.346667 242.346667 322.346667 170.666667l37.973333 76.586666A342.101333 342.101333 0 0 0 170.666667 553.770667c0 188.928 152.832 342.058667 341.333333 342.058666s341.333333-153.173333 341.333333-342.058666a342.101333 342.101333 0 0 0-189.653333-306.517334z" fill="#474A54" p-id="17832"></path><path d="M469.333333 42.666667h85.333334v341.333333h-85.333334z" fill="#474A54" p-id="17833"></path></svg>'
    }]);

    const adminObject = {
        name: '后台',
        call: (): Promise<void> => toggleAdminFrame(),
        icon: '<svg t="1736468937884" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16553" width="36" height="36"><path d="M730.7264 737.9456H290.56c-48.9984 0-91.8016-33.0752-104.1408-80.4864l-41.6768-144.4864h726.7328l-35.7888 141.2608c-11.2128 48.9984-54.7328 83.712-104.96 83.712z" fill="#ffa115" p-id="16554"></path><path d="M926.9248 243.712c-22.0672-14.8992-50.432-14.6432-72.2432 0.6144l-109.6704 76.8c-0.9728 0.7168-2.3552 0.512-3.1232-0.4096l-181.1456-213.504c-12.1344-14.2848-29.8496-22.528-48.64-22.528H512c-18.7904 0.0512-36.5568 8.2944-48.64 22.6816l-178.5856 211.968c-0.768 0.8704-2.0992 1.0752-3.072 0.4608L166.8096 244.6848c-21.76-14.2336-49.664-13.8752-71.0656 0.8704a63.51872 63.51872 0 0 0-26.1632 66.048l83.712 386.048c8.704 40.192 44.9024 69.4272 86.0672 69.4272h538.9824c41.2672 0 76.5952-28.1088 85.8112-68.3008l89.2416-387.84c5.9904-25.9584-4.4032-52.3776-26.4704-67.2256z m-33.3824 53.4016l-89.2928 387.84a26.4704 26.4704 0 0 1-25.9584 20.6336H239.36c-12.4416 0-23.3984-8.8064-26.0096-20.992l-83.712-386.048c-0.1536-0.768-0.3072-1.536 0.9728-2.4064 0.5632-0.3584 0.9728-0.512 1.3824-0.512 0.512 0 0.8704 0.256 1.2288 0.4608L248.064 371.2c26.9312 17.6128 62.9248 12.3392 83.6608-12.288l178.5856-211.9168c0.2048-0.2048 0.7168-0.8192 1.792-0.8192 1.0752 0 1.5872 0.6144 1.792 0.8192l181.1456 213.504c21.4528 25.2416 58.0608 30.0032 85.1968 11.008l109.6704-76.8c0.6656-0.4608 1.28-0.9216 2.6624 0 1.3312 0.8192 1.1776 1.5872 0.9728 2.4064zM834.2528 865.3824H189.0304c-16.9472 0-30.72 13.7728-30.72 30.72s13.7728 30.72 30.72 30.72h645.1712c16.9472 0 30.72-13.7728 30.72-30.72s-13.7216-30.72-30.6688-30.72z" fill="#474A54" p-id="16555"></path></svg>'
    };

    onMounted(() => {
        if (!insertStatus.value && !sidebarList.includes(adminObject) && applicationStore.userList.length > 0 && applicationStore.userList.find(item => item.uid === applicationStore.userInfo.uid).isAdmin) {
            sidebarList.splice(4, 0, adminObject);
            insertStatus.value = true;
        }
    });

    watch(applicationStore, (): void => {
        if (applicationStore.loginStatus && applicationStore.userList.length > 0 && applicationStore.userList.find(item => item.uid === applicationStore.userInfo.uid).isAdmin) {
            if (!sidebarList.includes(adminObject)) {
                sidebarList.splice(4, 0, adminObject);
                insertStatus.value = true;
            }
        }
    });
</script>

<template>
    <!-- 侧边栏容器,仅在非移动设备显示 -->
    <div class="sidebar-container" v-if="!applicationStore.isDeviceMobile">
        <div class="sidebar">
            <div class="avatar-box">
                <el-avatar class="avatar-info" shape="square" size="small" :src="applicationStore.loginStatus ? socket.server.config.serverUrl + socket.server.downloadAvatar + applicationStore.userInfo.avatar : applicationStore.userInfo.avatar" @click="setPersonalDialog(true)"/>
            </div>
            <div class="button-box">
                <div class="button-item" v-for="(item, index) in sidebarList" :key="index" :title="item.name" @click="item.call" v-html="item.icon"></div>
            </div>
        </div>
    </div>
</template>

<style lang="less">
    @import url("./styles/ChatSideBarV2.less");
</style>